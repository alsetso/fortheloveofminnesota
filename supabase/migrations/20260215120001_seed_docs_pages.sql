-- Seed initial documentation pages with codebase-aligned Markdown content.
-- Uses ON CONFLICT to be idempotent.

INSERT INTO docs.pages (slug, title, body, icon, sort_order) VALUES

('getting-started', 'Getting Started', E'Welcome to **Love of Minnesota** ‚Äî a community platform for discovering, sharing, and celebrating everything Minnesota.\n\nThis guide covers the basics to get you up and running.\n\n## Quick Start\n\n1. **Create an account** ‚Äî Visit `/signup` and enter your email. You''ll receive a 6-digit verification code.\n2. **Choose a username** ‚Äî Pick a unique handle (3‚Äì30 characters, letters, numbers, hyphens, underscores).\n3. **Add a profile photo** ‚Äî Optional but recommended.\n4. **Explore the map** ‚Äî The live map at `/` shows pins from the community across Minnesota.\n5. **Drop your first pin** ‚Äî Tap a location on the map and mark it with a tag.\n6. **Connect with others** ‚Äî Follow people from their profiles; mutual follows become friends.\n\n## Key Pages\n\n| Page | Path | What It Does |\n|------|------|--------------|\n| Home / Live Map | `/` | Community map with all public pins |\n| Explore | `/explore` | Discover layers, places, and data |\n| Maps | `/maps` | Browse and create custom maps |\n| News | `/news` | Community-generated news feed |\n| Settings | `/settings` | Profile, privacy, billing, and more |\n| Docs | `/docs` | You are here |\n\n## Need Help?\n\nEmail **loveofminnesota@gmail.com** ‚Äî we respond within 24‚Äì48 business hours.', 'InformationCircleIcon', 1),

('create-account', 'How to Create an Account', E'Creating an account is fast. The primary method is **email + one-time code** (OTP). No password required.\n\n## Steps\n\n1. Go to `/signup` or tap **Get Started** anywhere in the app.\n2. Enter your email address.\n3. Check your inbox for a **6-digit verification code**.\n4. Enter the code ‚Äî the app auto-submits when all 6 digits are filled.\n5. On first login you''re routed to **Onboarding** (`/onboarding`):\n   - **Welcome screen** ‚Äî brief intro.\n   - **Username** ‚Äî required, 3‚Äì30 characters. Real-time availability check.\n   - **Profile photo** ‚Äî optional, uploads to `profile-images` storage (max 5 MB, JPEG/PNG/GIF/WebP).\n6. Done ‚Äî you land on the home page.\n\n## Auth Methods\n\n| Method | Status |\n|--------|--------|\n| Email + OTP (6-digit code) | **Primary** |\n| Email + Magic Link | Available |\n| Email + Password | Available |\n| Google OAuth | Coming soon |\n| Apple OAuth | Not yet available |\n\n## Multiple Accounts\n\nAdmin users can create and switch between multiple accounts from **Settings ‚Üí Accounts** (`/settings/accounts`). Regular users have one account.\n\n## What Happens Behind the Scenes\n\nWhen you verify your email, Supabase Auth creates a user record. A database trigger (`handle_new_user`) automatically creates your account with `role = general` and `onboarded = false`. Onboarding sets your username and marks `onboarded = true`.', 'UserPlusIcon', 2),

('email-verification', 'Why Email Verification?', E'Every account on Love of Minnesota requires a verified email. Here''s why and how it works.\n\n## Why We Require It\n\n### Security\n- **Account ownership** ‚Äî proves you control the email address.\n- **Password recovery** ‚Äî enables account recovery flows.\n- **Spam prevention** ‚Äî stops bots and fake signups.\n\n### Community Trust\n- **Authentic contributors** ‚Äî real people sharing real Minnesota places.\n- **Safer connections** ‚Äî you know who you''re interacting with.\n- **Content integrity** ‚Äî verified accounts build trust in shared locations and stories.\n\n## How It Works\n\n1. Enter your email at `/signup`.\n2. The app calls `signInWithOtp()` through Supabase Auth, which sends a 6-digit code to your inbox.\n3. Enter the code on the verification screen.\n4. The app calls `verifyOtp()` to confirm the code.\n5. On success, your session is established and account created.\n\n## Troubleshooting\n\n- **No email?** Check your spam/junk folder.\n- **Code expired?** Request a new one from the login screen.\n- **Wrong email?** Go back and re-enter the correct address.\n\n> Some features are limited until verification is complete. Verification typically takes under a minute.', 'ShieldCheckIcon', 3),

('create-pin', 'How to Create a Pin', E'Pins are location markers on the map. They''re the core content type ‚Äî a way to tag, describe, and share Minnesota places.\n\n## Ways to Create a Pin\n\n### 1. From the Live Map\n- Tap any location on the map.\n- A popup appears with the address and coordinates.\n- Select a **tag** (mention type) to categorize the pin.\n- Tap **Mark Location** ‚Äî done. The pin is created via `POST /api/accounts/{id}/pins`.\n- A follow-up modal lets you add a description, photo, or assign to a collection.\n\n### 2. From the Create Modal\n- Tap the **Create** button (bottom bar or navigation).\n- The modal opens in **pin mode** by default.\n- Select a location on the map (required).\n- Choose a map (defaults to the Live map).\n- Enter a description and select a tag (required in this flow).\n- Optionally add an image or video, set visibility, or assign to a collection.\n- Submit ‚Äî creates via `MentionService.createMention()` ‚Üí RPC `insert_pin_to_maps_pins`.\n\n### 3. On a Custom Map\n- Navigate to any map you own or have edit access to (`/map/{id}`).\n- Click a location ‚Üí pin form opens.\n- Add emoji and caption.\n- Submit ‚Äî creates via `POST /api/maps/{id}/pins`.\n\n## Pin Fields\n\n| Field | Required | Notes |\n|-------|----------|-------|\n| Location (lat/lng) | Yes | Must be within Minnesota bounds |\n| Tag / Mention Type | Varies | Required in Create Modal; optional on map tap |\n| Description / Caption | Varies | Required in Create Modal; optional elsewhere |\n| Image | No | JPEG, PNG, GIF, WebP ‚Äî max 5 MB client-side |\n| Video | No | MP4, WebM, MOV ‚Äî requires Contributor plan |\n| Visibility | No | `public` (default) or `only_me` |\n| Collection | No | Assign to a collection for organization |\n\n## Visibility\n\n- **Public** ‚Äî visible to everyone on the map.\n- **Only Me** ‚Äî private, only you can see it.', 'MapPinIcon', 4),

('upload-photos', 'Uploading Photos & Media', E'Photos and videos bring your pins and posts to life. Here''s what''s supported and how uploads work.\n\n## Supported Formats\n\n### Images\n- JPEG / JPG\n- PNG\n- GIF\n- WebP\n\n### Videos\n- MP4, WebM, QuickTime (.mov)\n- AVI, WMV, OGG, 3GPP, Matroska (.mkv)\n- **Video uploads require the Contributor plan ($20/month)**\n\n## Size Limits\n\n| Context | Limit |\n|---------|-------|\n| Pin / post media | 100 MB (storage bucket) |\n| Client-side image validation | 5 MB |\n| Profile photo | 5 MB |\n| ID verification documents | 10 MB |\n\n## How to Upload\n\n### During Pin Creation\n1. Open the Create modal or finish-pin flow.\n2. Tap the image/camera icon.\n3. Select a file from your device.\n4. The image previews inline before submission.\n5. On submit, the file is stored in Supabase Storage (`pins-media` or `mentions-media` bucket).\n\n### Profile Photo\n1. Go to **Settings ‚Üí Account** (`/settings/account`).\n2. Tap your current photo or the upload area.\n3. Select an image (max 5 MB).\n4. Uploaded to the `profile-images` bucket.\n\n### Cover Image\n1. Go to **Settings ‚Üí Account** (`/settings/account`).\n2. Upload a cover image ‚Äî stored in the `cover-photos` bucket.\n\n## Storage Buckets\n\nThe platform uses several Supabase Storage buckets:\n\n| Bucket | Purpose |\n|--------|---------|\n| `posts-media` | Post images and videos |\n| `pins-media` | Pin images and videos |\n| `mentions-media` | Mention/pin media |\n| `profile-images` | Profile photos (5 MB limit) |\n| `cover-photos` | Cover images |\n| `id-verification-documents` | ID verification (private) |\n\n## Tips\n\n- Use high-quality photos for the best result.\n- Add captions to give context to your images.\n- Respect privacy ‚Äî don''t upload photos of others without permission.', 'PhotoIcon', 5),

('save-content', 'Saving Content & Collections', E'Save pins, posts, and other content to revisit later. Organize them into collections.\n\n## Saving Items\n\n1. Find a pin, post, or mention in the feed or on the map.\n2. Tap the **bookmark icon**.\n3. The item is added to your saved items.\n4. View all saved items at `/saved`.\n\nSaved items are stored in the `saved_items` table, linked to your account.\n\n## Collections\n\nCollections let you group pins by theme, trip, project, or anything else.\n\n### Creating a Collection\n1. Go to **Settings ‚Üí Collections** (`/settings/collections`).\n2. Tap **Create Collection**.\n3. Enter a title, optional description, and emoji (default: üìç).\n4. Set visibility: **Public** or **Private**.\n\n### Assigning Pins to Collections\n- When creating a pin, select a collection from the dropdown.\n- Or move existing pins into collections from the pin detail view.\n\n### Collection Fields\n\n| Field | Required | Notes |\n|-------|----------|-------|\n| Title | Yes | Name of the collection |\n| Emoji | No | Default üìç |\n| Description | No | Brief description |\n| Visibility | No | Public (default) or Private |\n\n## Limits\n\n| Plan | Collections Limit |\n|------|-------------------|\n| Hobby (free) | 5 collections |\n| Contributor ($20/mo) | Unlimited |\n\n## Browsing\n\n- `/saved` ‚Äî All your saved items (list or grid view, filterable by type).\n- `/collections` ‚Äî Browse your collections.\n- `/settings/collections` ‚Äî Manage, edit, delete collections.\n- Profile collections are visible on your public profile if set to Public.', 'BookmarkIcon', 6),

('friends-following', 'Friends & Following', E'Connect with other Minnesota community members through the follow system.\n\n## How It Works\n\nThe social graph is stored in `social_graph.edges`. Every connection is a directed edge.\n\n- **Following** ‚Äî You follow them. One-way.\n- **Follower** ‚Äî They follow you. One-way.\n- **Friends** ‚Äî Mutual follows. You follow each other.\n\nThere is no separate "friend request" flow. Follow someone; if they follow you back, you''re friends.\n\n## How to Follow\n\n1. Visit a user''s profile (`/{username}`).\n2. Tap the **Follow** button.\n3. The follow is instant ‚Äî no approval needed.\n4. Their content appears in your feed.\n5. If they follow you back, you become friends (mutual).\n\n## Managing Connections\n\n- View your connections on the **Friends** page.\n- Tabs: **Friends** (mutual), **Following**, **Followers**, **Suggestions**.\n- Unfollow from any profile or from the friends page.\n\n## Blocking\n\nYou can block a user to prevent interaction:\n- Block creates a `relationship: ''block''` edge in `social_graph.edges`.\n- Blocked users cannot see your content or follow you.\n\n## Follower Counts\n\nFollower and following counts are fetched via `/api/social/edges/{accountId}/counts` and displayed on profiles.', 'UserGroupIcon', 7),

('privacy-settings', 'Privacy Settings', E'Control who can find you and how your information is shared.\n\n## Privacy Options\n\nAccess privacy settings at **Settings ‚Üí Privacy** (`/settings/privacy`).\n\n| Setting | What It Controls |\n|---------|-----------------|\n| **Profile is searchable** | Whether others can find you in @ mention searches. Stored as `search_visibility` on your account. |\n| **Profile is taggable** | Whether others can tag you in mentions. Stored as `account_taggable` on your account. |\n\nBoth are toggles ‚Äî on or off. Changes save automatically.\n\n## Content Visibility\n\nWhen creating pins and content, you choose visibility per item:\n\n- **Public** ‚Äî Visible to everyone.\n- **Only Me** ‚Äî Only you can see it.\n\n## Profile Visibility\n\nYour profile at `/{username}` is public by default. Others can see:\n- Username, bio, profile photo, cover image\n- Public pins and collections\n- Follower/following counts\n\nPrivate pins (`only_me`) are never visible to others.\n\n## Data We Collect\n\nPer the privacy policy (`/privacy`, last updated January 8, 2026):\n- Email address\n- Profile information you provide\n- Content you create (pins, posts, mentions)\n- Location data (when you create pins)\n- Analytics data (page views, visits)\n\nSecurity: Row Level Security (RLS) on all tables, HTTPS, Supabase Auth.\n\n## Contact\n\nPrivacy questions: **privacy@fortheloveofminnesota.com**', 'LockClosedIcon', 8),

('account-settings', 'Account Settings', E'Manage your profile, preferences, and account details from the Settings hub.\n\n## Accessing Settings\n\nGo to `/settings` or tap the gear icon in the sidebar. The settings page shows an overview with your stats (pins, collections, maps, visits) and links to all sub-pages.\n\n## Settings Pages\n\n### General (`/settings/general`)\n- **State Verification** ‚Äî Verify your current location in Minnesota (expires after 30 days).\n- **Location Preferences** ‚Äî Set your city/town, county, and district.\n- **ID Verification** ‚Äî Upload a state ID for identity verification (`/settings/id`).\n\n### Account (`/settings/account`)\n- **First Name** and **Last Name**\n- **Username** ‚Äî 3‚Äì30 characters, real-time availability check.\n- **Bio** ‚Äî Max 240 characters.\n- **Traits** ‚Äî Multi-select personality/interest tags.\n- **Profile Photo** ‚Äî Upload (max 5 MB). Gold border for Contributor/Plus plans.\n- **Cover Image** ‚Äî Upload to `cover-photos` bucket.\n\n### Username (`/settings/username`)\n- Dedicated page for changing your @handle.\n\n### Privacy (`/settings/privacy`)\n- Searchable toggle, taggable toggle.\n- See the **Privacy Settings** doc for details.\n\n### Maps (`/settings/maps`)\n- View all your maps and limits.\n- Link to individual map settings.\n- Hobby plan: 3 maps. Contributor: unlimited.\n\n### Pins (`/settings/pins`)\n- Browse and manage your pins.\n\n### Collections (`/settings/collections`)\n- Create, edit, delete collections.\n- Hobby plan: 5 collections. Contributor: unlimited.\n\n### History (`/settings/history`)\n- Activity log and visit history.\n\n### Plans (`/settings/plans`)\n- Compare plans: Hobby (free), Contributor ($20/mo).\n- Feature comparison table with limits.\n\n### Billing (`/settings/billing`)\n- Current plan and subscription status.\n- Payment methods (Stripe).\n- Manage via Stripe billing portal.\n\n### Usage (`/settings/usage`)\n- Feature limits and current usage.\n- Grouped by category (Maps, Analytics, Content, Profile).', 'Cog6ToothIcon', 9),

('faq', 'Frequently Asked Questions', E'## How do I delete my account?\n\nGo to **Settings ‚Üí Account** (`/settings/account`). Account deletion is permanent and cannot be undone.\n\n## Can I change my username?\n\nYes. Go to **Settings ‚Üí Username** (`/settings/username`). Usernames must be unique, 3‚Äì30 characters (letters, numbers, hyphens, underscores).\n\n## How do I report inappropriate content?\n\nTap the **‚ãØ** menu on any pin or post and select **Report**. Our team reviews all reports.\n\n## Is Love of Minnesota free?\n\nYes. The **Hobby plan** is free and includes:\n- 3 custom maps\n- 5 collections\n- Unlimited public pins\n- Image uploads\n\nOptional: **Contributor plan** at $20/month adds unlimited maps, unlimited collections, video uploads, visitor analytics, extended text, gold profile border, and all-time historical data.\n\n## What are the plan options?\n\n| Plan | Price | Key Features |\n|------|-------|--------------|\n| Hobby | Free | 3 maps, 5 collections, image uploads |\n| Contributor | $20/month | Unlimited maps & collections, video, analytics |\n\n## Do I need to be in Minnesota?\n\nNo ‚Äî anyone can join. But pins must be placed **within Minnesota boundaries** (enforced server-side). State verification is optional and available at `/settings/general`.\n\n## What formats can I upload?\n\n**Images:** JPEG, PNG, GIF, WebP (max 5 MB client-side, 100 MB bucket limit).\n**Videos:** MP4, WebM, MOV, AVI, WMV, OGG, 3GPP, MKV (Contributor plan required).\n\n## How does the social system work?\n\nFollow users from their profile. Mutual follows = friends. No approval process ‚Äî follows are instant.\n\n## How do I contact support?\n\nEmail **loveofminnesota@gmail.com**. Response time: 24‚Äì48 business hours.\n\nYou can also reach us via the Contact page at `/contact`.', 'QuestionMarkCircleIcon', 10)

ON CONFLICT (slug) DO UPDATE SET
  title = EXCLUDED.title,
  body = EXCLUDED.body,
  icon = EXCLUDED.icon,
  sort_order = EXCLUDED.sort_order,
  updated_at = NOW();
